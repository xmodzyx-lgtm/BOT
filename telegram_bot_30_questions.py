
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, ContextTypes, filters

questions = [
    {
        "text": "1. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 1?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "2. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 2?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "3. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 3?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "4. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 4?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "5. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 5?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "6. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 6?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "7. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 7?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "8. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 8?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "9. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 9?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "10. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 10?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "11. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 11?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "12. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 12?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "13. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 13?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "14. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 14?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "15. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 15?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "16. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 16?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "17. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 17?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "18. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 18?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "19. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 19?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "20. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 20?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "21. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 21?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "22. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 22?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "23. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 23?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "24. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 24?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "25. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 25?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "26. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 26?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "27. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 27?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "28. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 28?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "29. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 29?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    },
    {
        "text": "30. –Ø–∫ —Ç–∏ –∑–∞–∑–≤–∏—á–∞–π —Ä–µ–∞–≥—É—î—à —É —Å–∏—Ç—É–∞—Ü—ñ—ó 30?",
        "options": [
            "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A",
            "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B"
        ]
    }
]

answer_scores = {
    "üîµ –í–∞—Ä—ñ–∞–Ω—Ç A": [
        "–ê–Ω–∞–ª—ñ—Ç–∏–∫",
        "–¢–≤–æ—Ä–µ—Ü—å"
    ],
    "üü¢ –í–∞—Ä—ñ–∞–Ω—Ç B": [
        "–õ—ñ–¥–µ—Ä",
        "–ì–∞—Ä–º–æ–Ω—ñ–∑–∞—Ç–æ—Ä"
    ]
}

user_answers = {}

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    user_answers[user_id] = {"current_q": 0, "scores": {"–ê–Ω–∞–ª—ñ—Ç–∏–∫": 0, "–¢–≤–æ—Ä–µ—Ü—å": 0, "–õ—ñ–¥–µ—Ä": 0, "–ì–∞—Ä–º–æ–Ω—ñ–∑–∞—Ç–æ—Ä": 0}}
    await send_question(update, context)

async def send_question(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    q_index = user_answers[user_id]["current_q"]
    if q_index >= len(questions):
        await update.message.reply_text("–û–ø–∏—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ.")
        return
    question = questions[q_index]
    keyboard = ReplyKeyboardMarkup([[opt] for opt in question["options"]], one_time_keyboard=True, resize_keyboard=True)
    await update.message.reply_text(question["text"], reply_markup=keyboard)

async def handle_response(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    response = update.message.text
    user_state = user_answers.get(user_id)

    if not user_state:
        await update.message.reply_text("–ù–∞–ø–∏—à–∏ /start, —â–æ–± –ø–æ—á–∞—Ç–∏.")
        return

    types = answer_scores.get(response, [])
    for t in types:
        user_state["scores"][t] += 1

    user_state["current_q"] += 1
    if user_state["current_q"] < len(questions):
        await send_question(update, context)
    else:
        scores = user_state["scores"]
        top_type = max(scores, key=scores.get)
        summary = {
            "–ê–Ω–∞–ª—ñ—Ç–∏–∫": "üß† –¢–∏ ‚Äî –ê–Ω–∞–ª—ñ—Ç–∏–∫: –ª–æ–≥—ñ—á–Ω–∏–π, –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–∏–π, —Ä–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π.",
            "–¢–≤–æ—Ä–µ—Ü—å": "üé® –¢–∏ ‚Äî –¢–≤–æ—Ä–µ—Ü—å: –∫—Ä–µ–∞—Ç–∏–≤–Ω–∏–π, —ñ–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π, –≥–Ω—É—á–∫–∏–π.",
            "–õ—ñ–¥–µ—Ä": "üß≠ –¢–∏ ‚Äî –õ—ñ–¥–µ—Ä: –µ–Ω–µ—Ä–≥—ñ–π–Ω–∏–π, –≤–ø–µ–≤–Ω–µ–Ω–∏–π, —ñ–Ω—ñ—Ü—ñ–∞—Ç–∏–≤–Ω–∏–π.",
            "–ì–∞—Ä–º–æ–Ω—ñ–∑–∞—Ç–æ—Ä": "üå± –¢–∏ ‚Äî –ì–∞—Ä–º–æ–Ω—ñ–∑–∞—Ç–æ—Ä: –≤—Ä—ñ–≤–Ω–æ–≤–∞–∂–µ–Ω–∏–π, –¥—Ä—É–∂–Ω—ñ–π, —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π."
        }
        await update.message.reply_text(f"‚úÖ –ì–æ—Ç–æ–≤–æ!\n\n{summary[top_type]}")

if __name__ == '__main__':
    app = ApplicationBuilder().token("–í–°–¢–ê–í_–°–Æ–î–ò_–°–í–Ü–ô_BOT_TOKEN").build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & (~filters.COMMAND), handle_response))
    app.run_polling()
